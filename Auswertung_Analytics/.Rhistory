x3 <- runif(n_points, 0, 7)
x4 <- runif(n_points, 0, 8)
# Überprüfen, ob die Punkte alle Ungleichungen erfüllen
valid_points <- (
# x1+x2+x3+x4==7 &
x1 + x2 <= 2 &
x1 + x3 <= 7 &
x1+x2+x3 <= 7 &
x2+x3 <= 5 &
x1 <= 2 &
x2 <= 2 &
x3 <= 6 &
x4 <= 7 &
x1 >= 0 &
x2 >= 0 &
x3 >= 0 &
x4 >= 0
)
# Punkte, die die Bedingungen erfüllen
result <- data.frame(x1 = x1[valid_points],
x2 = x2[valid_points],
x3 = x3[valid_points],
x4 = x4[valid_points])
# Beispiel: Projektion von x1 und x2
ggplot(result, aes(x = x1, y = x2)) +
geom_point(alpha = 0.3, color = "blue") +
labs(title = "Projektion von x1 und x2", x = "x1", y = "x2") +
theme_minimal()
plot_ly(data = result, x = ~x1, y = ~x2, z = ~x3, type = "scatter3d", mode = "markers",
marker = list(size = 2, color = "blue")) %>%
layout(title = "3D-Visualisierung des Bereichs",
scene = list(
xaxis = list(title = "x1"),
yaxis = list(title = "x2"),
zaxis = list(title = "x3")
))
# D-Land-Modal Split
df <- data.frame(
name=c("Zu Fuß","Fahrrad","Auto","Bus/Bahn") ,
value=c(22, 11, 57, 10)
)
p0 <- function(df_, art_text, halbjahr_) {
df1 <- df_ %>% filter(halbjahr == halbjahr_)
df1 %>%
ggplot(aes(x="", y=anz, fill=verkehrsart)) +
geom_bar(stat="identity", position = "fill", alpha = .75) +
geom_text(aes(label = paste0(round(anz / sum(anz) * 100, 1), "%")), position = position_fill(vjust = 0.5), size=3.5) +
scale_y_continuous(labels = scales::percent) +
labs(title="Modal Split",
subtitle=paste0("alle Befragungen - ", art_text),
caption=paste0(
paste("n =",format(sum(df1$anz), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
", Stand: ", Sys.Date()),
x="", y="") +
scale_fill_manual(name = "Verkehrsart",
values = c('fuß'='lightblue', 'roller'='orange', 'rad'='blue', 'mrad'='violet', 'auto'='red', 'bus/bahn'='darkgreen', 'sonst'='pink'),
breaks=c('fuß', 'roller', 'rad', 'mrad', 'auto', 'bus/bahn', 'sonst'),
labels=c('Zu Fuß', 'Roller', 'Fahrrad', 'Motorroller', 'Auto', 'Bus/Bahn', 'Sonstiges'),
) +
coord_flip() +
theme_minimal() +
theme(legend.position = "right", legend.direction = "vertical", legend.justification = "left")
}
p0(df, Deutschland, Ganzjahr)
p0(df, Deutschland, )
p0(df, Deutschland, '')
# D-Land-Modal Split
df <- data.frame(
name=c("Zu Fuß","Fahrrad","Auto","Bus/Bahn") ,
value=c(22, 11, 57, 10),
halbjahr(0, 0, 0, 0)
)
p0(df, Deutschland, 0)
# D-Land-Modal Split
df <- data.frame(
name=c("Zu Fuß","Fahrrad","Auto","Bus/Bahn") ,
value=c(22, 11, 57, 10),
halbjahr = c(0, 0, 0, 0)
)
p0(df, Deutschland, 0)
p0(df, Deutschland, 0)
head(df)
# D-Land-Modal Split
df <- data.frame(
name=c("Zu Fuß","Fahrrad","Auto","Bus/Bahn") ,
value=c(22, 11, 57, 10),
)
# D-Land-Modal Split
df <- data.frame(
name=c("Zu Fuß","Fahrrad","Auto","Bus/Bahn") ,
value=c(22, 11, 57, 10),
)
# D-Land-Modal Split
df <- data.frame(
name=c("Zu Fuß","Fahrrad","Auto","Bus/Bahn"),
value=c(22, 11, 57, 10)
)
# Import
config_path <- Sys.getenv("R_CONFIG_PATH")
source(config_path)
library(DBI)
library(ggplot2)
library(dplyr)
library(png)
library(ggpattern)
library(gridExtra)
# Verbindung zur MySQL-Datenbank herstellen
con <- dbConnect(RMySQL::MySQL(),
dbname = db_name,
host = db_host,
user = db_user,
password = db_pw)
dbListTables(con)
sql <- "with a as (select id, passwort, REPLACE(beschreibung, ' ', '') as beschreibung, ST_Length(koordinaten)*111195 as len  from geodaten where typ = 'route' and ST_Length(koordinaten) > 0 and beschreibung not in ( '', 'E-Scooter', 'Motorrad,Moped,Mofa')), b as (select passwort from einrichtung e where art = 'grund') select beschreibung, sum(len)/count(beschreibung) as mittel, count(*) as anz from a inner join b on a.passwort = b.passwort group by beschreibung order by anz;"
df <- dbGetQuery(con, sql)
head(df)
df$beschreibung2 <- dplyr::recode(df$beschreibung,
"zuFuss" = "Zu Fuß",
"Tretroller" = "Tretroller",
"mitFahrrad" = "Fahrrad",
"Motorrad,Moped,Mofa" = "Motorroller",
"Auto,Elterntaxi" = "Auto",
"Bus,Bahn" = "Bus/Bahn",
"E-Scooter" = "E-Scooter"
)
df <- df%>%filter(beschreibung2 != 'Motorroller')
ggplot(df, aes(x=mittel, y=beschreibung2, fill=anz)) +
geom_bar(stat="identity", alpha = .75) +
geom_text(aes(label = paste(format(anz, big.mark = ".", decimal.mark = ",", scientific = FALSE), "p.")),
position = position_dodge(width = 0), hjust=ifelse(df$mittel > max(df$mittel) * 0.5, 1.1, -0.1),
color="black") +
# Beschriftungen der Grafik außenrum
labs(title="Mittlere Wegelänge an Grundschulen",
subtitle="nach Verkehrsmittel und Entfernung",
caption=paste0(
"n =", format(sum(df$anz), big.mark = ".", decimal.mark = ",", scientific = FALSE),
", Stand: ", format(Sys.Date(), "%d.%m.%Y")),
x="Meter", y="", fill = "Personenanzahl"
) +
# Anpassen der Scalenbreite auf x &&
# Achswerte zu lesbaren Zahlen
scale_x_continuous( breaks = seq(0, max(df$mittel)+200, by = 250), labels = scales::comma_format(big.mark = ".", decimal.mark = ",")) +
# Anpassen der Füllfarbe
scale_fill_gradient(low = "lightblue", high ="darkred") +
theme_minimal()
# Boxplot
sql <- "with a as ( select id, passwort, REPLACE(beschreibung, ' ', '') as beschreibung, round(ST_Length(koordinaten)*111195,2) as len from geodaten where typ = 'route' and ST_Length(koordinaten) > 0 and beschreibung not in ( '', 'E-Scooter', 'Motorrad,Moped,Mofa') ), b as (select passwort from einrichtung e where art = 'grund' ) select beschreibung, len from a inner join b on a.passwort = b.passwort where len < 5000;"
df <- dbGetQuery(con, sql)
df$beschreibung <- dplyr::recode(df$beschreibung,
"zuFuss" = "Zu Fuß",
"ZuFuss" = "Zu Fuß",
"Tretroller" = "Tretroller",
"mitFahrrad" = "Fahrrad",
"MitFahrrad" = "Fahrrad",
"Motorrad,Moped,Mofa" = "Motorroller",
"Auto,Elterntaxi" = "Auto",
"Bus,Bahn" = "Bus/Bahn",
"E-Scooter" = "E-Scooter"
)
df <- df%>%filter(beschreibung != 'Motorroller')
summary(df)
print(df)
#png(filename="D:/Auswertung Befragungen/R-erg/mittlererweg_boxplot_grund.png", width = 21, height = 14.8, res = 600, units = 'cm')#A5
ggplot(df, aes(x=len, y=beschreibung, fill=beschreibung)) +
geom_boxplot(alpha = .75)+
# Beschriftungen der Grafik außenrum
labs(title="Mittlere Wegelänge an Grundschulen",
subtitle="nach Verkehrsmittel und Entfernung bis 5 Km",
caption=paste0(
"n =", format(length(df$beschreibung), big.mark = ".", decimal.mark = ",", scientific = FALSE),
", Stand: ", format(Sys.Date(), "%d.%m.%Y")),
x="Meter", y="", fill = "Personenanzahl"
) +
# Anpassen der Scalenbreite auf x &&
# Achswerte zu lesbaren Zahlen
scale_x_continuous( breaks = seq(0, max(df$len)+10, by = 500), labels = scales::comma_format(big.mark = ".", decimal.mark = ",")) +
theme_minimal()+
theme(legend.position = 'none')
install.packages("languageserver")
install.packages("RPostgres")
install.packages("ggplot2")
install.packages("tibble")
install.packages("languageserver")
#set working directory
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
#load packages
config_path <- Sys.getenv("R_CONFIG_PATH")
source(config_path)
library(ggplot2)
library(dplyr)
library(png)
library(ggpattern)
library(hrbrthemes)
library(scales)
library(lubridate)
date = "01.07.2025"
out <- "D:/Erhebungen/2025-07 Rheinbahn Düsseldorf/Digitale_Verkehrsauswertung_01_07_2025_vormittag_cam1.png"
pfad = "D:/Erhebungen/2025-07 Rheinbahn Düsseldorf/Video/01.07.2025/cam1/7-10.15Uhr/Rheinbahn_2025-07-03_15-06-57.counts_15min_reduziert.csv"
file <- paste0(pfad)
# Read the CSV file into R
events <- read.csv(file, header = TRUE)
# Daten vorbereiten: Summen je Kategorie berechnen
df <- events %>%
group_by(classification) %>%
summarise(summe = sum(count, na.rm = TRUE), .groups = "drop") %>%
filter(summe > 10) %>%
pull(classification)
event = events %>%
filter(classification %in% df) %>%
mutate(
time = as.POSIXct(start.time, format="%Y-%m-%d %H:%M:%S")
) %>%
#filter(
#  from.section == "A" | to.section == "A"
#) %>%
group_by(
classification, time
) %>%
summarise(
anz = sum(count, na.rm = TRUE),
.groups = "drop"
)
d1 <- event %>%
ggplot(aes(x=time, y=anz, color=classification))+
geom_point()+
geom_line()+
geom_label(aes(label = anz), nudge_y = 1, size = 3)+
#scale_x_datetime( breaks = seq(as.POSIXct(min(event$time)), as.POSIXct(max(event$time)), by = "1 hour"),
#  labels = date_format("%H:%M")
# )+
#scale_x_continuous(labels = format_hhmm,)+
labs(title = "Digitale Verkehrsauswertung - Rheinbahn",
subtitle = date,
caption = paste("n =",format( nrow(event), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
x = "Uhrzeit",
y = "Anzahl",
color = "Farzeugart") +
theme_light()+
theme(legend.position = "bottom")
d1
date = "14.10.2025"
out <- "D:/Erhebungen/2025-10 Kiel/Knoten 1/Digitale_Verkehrsauswertung_14_10_2025_nachmittag_knoten1.png"
pfad = "D:/Erhebungen/2025-10 Kiel/Knoten 1/14 Uhr unten/2025-10-21_15-12-13.counts_15min_reduziert.csv"
file <- paste0(pfad)
# Read the CSV file into R
events <- read.csv(file, header = TRUE)
# Daten vorbereiten: Summen je Kategorie berechnen
df <- events %>%
group_by(classification) %>%
summarise(summe = sum(count, na.rm = TRUE), .groups = "drop") %>%
filter(summe > 10) %>%
pull(classification)
event = events %>%
filter(classification %in% df) %>%
mutate(
time = as.POSIXct(start.time, format="%Y-%m-%d %H:%M:%S")
) %>%
#filter(
#  from.section == "A" | to.section == "A"
#) %>%
group_by(
classification, time
) %>%
summarise(
anz = sum(count, na.rm = TRUE),
.groups = "drop"
)
d1 <- event %>%
ggplot(aes(x=time, y=anz, color=classification))+
geom_point()+
geom_line()+
geom_label(aes(label = anz), nudge_y = 1, size = 3)+
#scale_x_datetime( breaks = seq(as.POSIXct(min(event$time)), as.POSIXct(max(event$time)), by = "1 hour"),
#  labels = date_format("%H:%M")
# )+
#scale_x_continuous(labels = format_hhmm,)+
labs(title = "Digitale Verkehrsauswertung - Rheinbahn",
subtitle = date,
caption = paste("n =",format( nrow(event), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
x = "Uhrzeit",
y = "Anzahl",
color = "Farzeugart") +
theme_light()+
theme(legend.position = "bottom")
d1
# Read the CSV file into R
events <- read.csv(file, header = TRUE)
# Daten vorbereiten: Summen je Kategorie berechnen
df <- events %>%
group_by(classification) %>%
summarise(summe = sum(count, na.rm = TRUE), .groups = "drop") %>%
filter(summe > 10) %>%
pull(classification)
date = "14.10.2025"
out <- "D:/Erhebungen/2025-10 Kiel/Knoten 1/Digitale_Verkehrsauswertung_14_10_2025_nachmittag_knoten1.png"
pfad = "D:/Erhebungen/2025-10 Kiel/Knoten 1/14 Uhr unten/2025-10-21_15-12-13.counts_15min_reduziert.csv"
file <- paste0(pfad)
out <- "D:/Erhebungen/2025-10 Kiel/Knoten 1/Digitale_Verkehrsauswertung_14_10_2025_nachmittag_knoten1.png"
pfad = "D:/Erhebungen/2025-10 Kiel/Knoten 1/14 Uhr unten/2025-10-21_15-12-13.counts_15min_reduziert.csv"
file <- paste0(pfad)
# Read the CSV file into R
events <- read.csv(file, header = TRUE)
# Daten vorbereiten: Summen je Kategorie berechnen
df <- events %>%
group_by(classification) %>%
summarise(summe = sum(count, na.rm = TRUE), .groups = "drop") %>%
filter(summe > 10) %>%
pull(classification)
event = events %>%
filter(classification %in% df) %>%
mutate(
time = as.POSIXct(start.time, format="%Y-%m-%d %H:%M:%S")
) %>%
#filter(
#  from.section == "A" | to.section == "A"
#) %>%
group_by(
classification, time
) %>%
summarise(
anz = sum(count, na.rm = TRUE),
.groups = "drop"
)
d1 <- event %>%
ggplot(aes(x=time, y=anz, color=classification))+
geom_point()+
geom_line()+
geom_label(aes(label = anz), nudge_y = 1, size = 3)+
#scale_x_datetime( breaks = seq(as.POSIXct(min(event$time)), as.POSIXct(max(event$time)), by = "1 hour"),
#  labels = date_format("%H:%M")
# )+
#scale_x_continuous(labels = format_hhmm,)+
labs(title = "Digitale Verkehrsauswertung - Rheinbahn",
subtitle = date,
caption = paste("n =",format( nrow(event), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
x = "Uhrzeit",
y = "Anzahl",
color = "Farzeugart") +
theme_light()+
theme(legend.position = "bottom")
d1
d1 <- event %>%
ggplot(aes(x=time, y=anz, color=classification))+
geom_point()+
geom_line()+
geom_label(aes(label = anz), nudge_y = 1, size = 3)+
#scale_x_datetime( breaks = seq(as.POSIXct(min(event$time)), as.POSIXct(max(event$time)), by = "1 hour"),
#  labels = date_format("%H:%M")
# )+
#scale_x_continuous(labels = format_hhmm,)+
labs(title = "Digitale Verkehrsauswertung - Kiel",
subtitle = date,
caption = paste("n =",format( nrow(event), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
x = "Uhrzeit",
y = "Anzahl",
color = "Farzeugart") +
theme_light()+
theme(legend.position = "bottom")
d1
png(filename=paste0(out), width = 21, height = 14.8, res = 600, units = 'cm')#A5
d1
dev.off()
out <- "D:/Erhebungen/2025-10 Kiel/Knoten 1/Digitale_Verkehrsauswertung_14_10_2025_vormittag_knoten1.png"
pfad = "D:/Erhebungen/2025-10 Kiel/Knoten 1/06 Uhr unten/2025-10-21_15-12-13.counts_15min_reduziert.csv"
file <- paste0(pfad)
# Read the CSV file into R
events <- read.csv(file, header = TRUE)
pfad = "D:/Erhebungen/2025-10 Kiel/Knoten 1/06 Uhr unten/2025-10-21_15-12-13.counts_15min_reduziert.csv"
file <- paste0(pfad)
# Read the CSV file into R
events <- read.csv(file, header = TRUE)
pfad = "D:/Erhebungen/2025-10 Kiel/Knoten 1/06 Uhr/2025-10-21_15-12-13.counts_15min_reduziert.csv"
file <- paste0(pfad)
# Read the CSV file into R
events <- read.csv(file, header = TRUE)
# Daten vorbereiten: Summen je Kategorie berechnen
df <- events %>%
group_by(classification) %>%
summarise(summe = sum(count, na.rm = TRUE), .groups = "drop") %>%
filter(summe > 10) %>%
pull(classification)
event = events %>%
filter(classification %in% df) %>%
mutate(
time = as.POSIXct(start.time, format="%Y-%m-%d %H:%M:%S")
) %>%
#filter(
#  from.section == "A" | to.section == "A"
#) %>%
group_by(
classification, time
) %>%
summarise(
anz = sum(count, na.rm = TRUE),
.groups = "drop"
)
d1 <- event %>%
ggplot(aes(x=time, y=anz, color=classification))+
geom_point()+
geom_line()+
geom_label(aes(label = anz), nudge_y = 1, size = 3)+
#scale_x_datetime( breaks = seq(as.POSIXct(min(event$time)), as.POSIXct(max(event$time)), by = "1 hour"),
#  labels = date_format("%H:%M")
# )+
#scale_x_continuous(labels = format_hhmm,)+
labs(title = "Digitale Verkehrsauswertung - Kiel",
subtitle = date,
caption = paste("n =",format( nrow(event), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
x = "Uhrzeit",
y = "Anzahl",
color = "Farzeugart") +
theme_light()+
theme(legend.position = "bottom")
d1
png(filename=paste0(out), width = 21, height = 14.8, res = 600, units = 'cm')#A5
d1
dev.off()
d1 <- event %>%
ggplot(aes(x=time, y=anz, color=classification))+
geom_point()+
geom_line()+
geom_label(aes(label = anz), nudge_y = 1, size = 3)+
#scale_x_datetime( breaks = seq(as.POSIXct(min(event$time)), as.POSIXct(max(event$time)), by = "1 hour"),
#  labels = date_format("%H:%M")
# )+
#scale_x_continuous(labels = format_hhmm,)+
labs(title = "Digitale Verkehrsauswertung - Kiel",
subtitle = date,
caption = paste("n = None")#,format( nrow(event), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
x = "Uhrzeit",
d1
d1 <- event %>%
ggplot(aes(x=time, y=anz, color=classification))+
geom_point()+
geom_line()+
geom_label(aes(label = anz), nudge_y = 1, size = 3)+
#scale_x_datetime( breaks = seq(as.POSIXct(min(event$time)), as.POSIXct(max(event$time)), by = "1 hour"),
#  labels = date_format("%H:%M")
# )+
#scale_x_continuous(labels = format_hhmm,)+
labs(title = "Digitale Verkehrsauswertung - Kiel",
subtitle = date,
caption = paste0("n = None")#,format( nrow(event), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
x = "Uhrzeit",
d1 <- event %>%
ggplot(aes(x=time, y=anz, color=classification))+
geom_point()+
geom_line()+
geom_label(aes(label = anz), nudge_y = 1, size = 3)+
#scale_x_datetime( breaks = seq(as.POSIXct(min(event$time)), as.POSIXct(max(event$time)), by = "1 hour"),
#  labels = date_format("%H:%M")
# )+
#scale_x_continuous(labels = format_hhmm,)+
labs(title = "Digitale Verkehrsauswertung - Kiel",
subtitle = date,
caption = paste("n = ","None"),#,format( nrow(event), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
x = "Uhrzeit",
y = "Anzahl",
color = "Farzeugart") +
theme_light()+
theme(legend.position = "bottom")
d1
png(filename=paste0(out), width = 21, height = 14.8, res = 600, units = 'cm')#A5
d1
dev.off()
out <- "D:/Erhebungen/2025-10 Kiel/Knoten 1/Digitale_Verkehrsauswertung_14_10_2025_nachmittag_knoten1.png"
pfad = "D:/Erhebungen/2025-10 Kiel/Knoten 1/14 Uhr/2025-10-21_15-12-13.counts_15min_reduziert.csv"
file <- paste0(pfad)
# Read the CSV file into R
events <- read.csv(file, header = TRUE)
# Daten vorbereiten: Summen je Kategorie berechnen
df <- events %>%
group_by(classification) %>%
summarise(summe = sum(count, na.rm = TRUE), .groups = "drop") %>%
filter(summe > 10) %>%
pull(classification)
event = events %>%
filter(classification %in% df) %>%
mutate(
time = as.POSIXct(start.time, format="%Y-%m-%d %H:%M:%S")
) %>%
#filter(
#  from.section == "A" | to.section == "A"
#) %>%
group_by(
classification, time
) %>%
summarise(
anz = sum(count, na.rm = TRUE),
.groups = "drop"
)
d1 <- event %>%
ggplot(aes(x=time, y=anz, color=classification))+
geom_point()+
geom_line()+
geom_label(aes(label = anz), nudge_y = 1, size = 3)+
#scale_x_datetime( breaks = seq(as.POSIXct(min(event$time)), as.POSIXct(max(event$time)), by = "1 hour"),
#  labels = date_format("%H:%M")
# )+
#scale_x_continuous(labels = format_hhmm,)+
labs(title = "Digitale Verkehrsauswertung - Kiel",
subtitle = date,
caption = paste("n = ","None"),#,format( nrow(event), big.mark = ".", decimal.mark = ",", scientific = FALSE)),
x = "Uhrzeit",
y = "Anzahl",
color = "Farzeugart") +
theme_light()+
theme(legend.position = "bottom")
d1
png(filename=paste0(out), width = 21, height = 14.8, res = 600, units = 'cm')#A5
d1
dev.off()
